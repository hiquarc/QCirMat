(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     48914,       1283]
NotebookOptionsPosition[     48540,       1268]
NotebookOutlinePosition[     48957,       1285]
CellTagsIndexPosition[     48914,       1282]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"\:6b22\:8fce\:4f7f\:7528QCirMat", " ", "v0", ".3"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
  "(*", "\:57fa\:672c\:91cf\:5b50\:6001\:7684\:77e9\:9635Ket\:8868\:793a", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Ket0", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "1", "}"}], ",", 
      RowBox[{"{", "0", "}"}]}], "}"}]}], "\n", 
   RowBox[{"Ket1", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "0", "}"}], ",", 
      RowBox[{"{", "1", "}"}]}], "}"}]}], "\n", 
   RowBox[{"KetPlus", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", "1", "}"}]}], "}"}]}]}], "\n", 
   RowBox[{"KetMinus", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "1"}], "}"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"KetBell", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", "1", "}"}]}], "}"}]}]}], "\n", 
   RowBox[{"KetBell01", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", "0", "}"}]}], "}"}]}]}], "\n", 
   RowBox[{"KetBell10", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "1"}], "}"}]}], "}"}]}]}], "\n", 
   RowBox[{"KetBell11", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{"{", "1", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "1"}], "}"}], ",", 
       RowBox[{"{", "0", "}"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"KetBloch", "[", 
     RowBox[{"theta_", ",", "phi_", ",", "gamma_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{"I", "*", "gamma"}], "]"}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", "phi"}], "]"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], "}"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
   "(*", "\:57fa\:672c\:91cf\:5b50\:6001\:7684\:77e9\:9635Bra\:8868\:793a", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Bra0", ":=", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], "}"}]}], "\n", 
   RowBox[{"Bra1", ":=", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], "}"}]}], "\n", 
   RowBox[{"BraPlus", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], "}"}]}]}], "\n", 
   RowBox[{"BraMinus", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}]}], "}"}], "}"}]}]}], "\n", 
   RowBox[{"BraBell", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], "}"}]}]}], "\n", 
   RowBox[{"BraBell01", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], "}"}]}]}], "\n", 
   RowBox[{"BraBell10", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", 
        RowBox[{"-", "1"}]}], "}"}], "}"}]}]}], "\n", 
   RowBox[{"BraBell11", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", 
        RowBox[{"-", "1"}], ",", "0"}], "}"}], "}"}]}]}], "\n", 
   RowBox[{
    RowBox[{"BraBloch", "[", 
     RowBox[{"theta_", ",", "phi_", ",", "gamma_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "I"}], "*", "gamma"}], "]"}], "*", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "I"}], "*", "phi"}], "]"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], "}"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
   "(*", "\:57fa\:672c\:91cf\:5b50\:6001\:7684\:5bc6\:5ea6\:77e9\:9635\:8868\
\:793a", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Rho0", ":=", 
    RowBox[{"Ket0", ".", "Bra0"}]}], "\[IndentingNewLine]", 
   RowBox[{"Rho1", ":=", 
    RowBox[{"Ket1", ".", "Bra1"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoPlus", ":=", 
    RowBox[{"KetPlus", ".", "BraPlus"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoMinus", ":=", 
    RowBox[{"KetMinus", ".", "BraMinus"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoBell", ":=", 
    RowBox[{"KetBell", ".", "BraBell"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoBell01", ":=", 
    RowBox[{"KetBell01", ".", "BraBell01"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoBell10", ":=", 
    RowBox[{"KetBell10", ".", "BraBell10"}]}], "\[IndentingNewLine]", 
   RowBox[{"RhoBell11", ":=", 
    RowBox[{"KetBell11", ".", "BraBell11"}]}], "\n", 
   RowBox[{
    RowBox[{"RhoBloch", "[", 
     RowBox[{"theta_", ",", "phi_", ",", "gamma_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"KetBloch", "[", 
      RowBox[{"theta", ",", "phi", ",", "gamma"}], "]"}], ".", 
     RowBox[{"BraBloch", "[", 
      RowBox[{"theta", ",", "phi", ",", "gamma"}], "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
   "(*", "\:57fa\:672c\:91cf\:5b50\:95e8\:7684\:77e9\:9635\:8868\:793a", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"H", ":=", 
    RowBox[{
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "}"}]}]}], "\n", 
   RowBox[{"Id", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"X", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"Y", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", "I"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"I", ",", "0"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"Z", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"S", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "I"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"T", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", 
          RowBox[{"Pi", "/", "4"}]}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"Sdag", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", "I"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"Tdag", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], "*", 
          RowBox[{"Pi", "/", "4"}]}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"SqrtX", ":=", 
    RowBox[{"H", ".", "S", ".", "H"}]}], "\n", 
   RowBox[{"SqrtXdag", ":=", 
    RowBox[{"H", ".", "Sdag", ".", "H"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
   "(*", "\:591a\:6bd4\:7279\:91cf\:5b50\:95e8\:7684\:77e9\:9635\:8868\:793a",
     "*)"}], "\n", 
   RowBox[{"CNOT", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"CNOT21", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"SWAP", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"CZ", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{"iSWAP", ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "I", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "I", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
   "(*", "\:542b\:53c2\:91cf\:5b50\:95e8\:7684\:77e9\:9635\:8868\:793a", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Rx", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"Ry", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"Rz", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"U1", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", "theta"}], "]"}]}], "}"}]}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"U3", "[", 
     RowBox[{"theta_", ",", "phi_", ",", "lambda_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", "*", "lambda"}], "]"}]}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", "phi"}], "]"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", 
           RowBox[{"(", 
            RowBox[{"lambda", "+", "phi"}], ")"}]}], "]"}], "*", 
         RowBox[{"Cos", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Rxx", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", "0", ",", "0", ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", "0", ",", "0", ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ryy", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", "0", ",", "0", ",", 
        RowBox[{"I", "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"I", "*", 
         RowBox[{"Sin", "[", 
          RowBox[{"theta", "/", "2"}], "]"}]}], ",", "0", ",", "0", ",", 
        RowBox[{"Cos", "[", 
         RowBox[{"theta", "/", "2"}], "]"}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Rzz", "[", "theta_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}], ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}], ",", "0", ",", "0"}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], "*", 
          RowBox[{"theta", "/", "2"}]}], "]"}]}], "}"}]}], "}"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\:5bf9\:6613\:5b50\:548c\:53cd\:5bf9\:6613\:5b50", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Commutator", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"a", ".", "b"}], "-", 
     RowBox[{"b", ".", "a"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AntiCommutator", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"a", ".", "b"}], "+", 
     RowBox[{"a", ".", "b"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:5728\:5177\:6709nqbits\:4e2a\:91cf\:5b50\:6bd4\:7279\:7684\:7ebf\:8def\
\:4e0a", "\:ff0c", 
     "\:5bf9\:4ee5indexlist\:5217\:8868\:4e3a\:4e0b\:6807\:7684\:4e00\:7cfb\
\:5217\:91cf\:5b50\:6bd4\:7279", "\:ff0c", "\:5e94\:7528gate\:95e8", "\:ff0c",
      "\:751f\:6210\:76f8\:5e94\:7684\:77e9\:9635\:8868\:793a", "\:3002", 
     "indexlist\:7684\:91cf\:5b50\:6bd4\:7279\:4e2a\:6570\:5e94\:4e0egate\
\:95e8\:7684\:7ef4\:5ea6\:76f8\:5339\:914d", "\:3002"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ApplyGate", "[", 
     RowBox[{"gate_", ",", "nqbits_", ",", "indexlist_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ret", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "^", "nqbits"}], ",", 
             RowBox[{"2", "^", "nqbits"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"cond", "=", "True"}], ",", "gdim", ",", "i", ",", "j", ",", 
        "k", ",", "ngatebits", ",", "cindexlist", ",", "tmpval1", ",", 
        "tmpval2", ",", "digi1", ",", "digi2", ",", "addlist"}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"ApplyGate", "::", "errmsg1"}], "=", 
        "\"\<\:53c2\:6570gate\:5fc5\:987b\:662f\:5177\:6709(2^k)\[Times](2^k)\
\:7ef4\:5ea6\:7684\:77e9\:9635\:ff01\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ApplyGate", "::", "errmsg2"}], "=", 
        "\"\<\:53c2\:6570indexlist\:5fc5\:987b\:662f\:65e0\:91cd\:590d\:7684\
\:5408\:6cd5\:7684\:4e0b\:6807\:5217\:8868\:ff01\>\""}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ApplyGate", "::", "errmsg3"}], "=", 
        "\"\<\:53c2\:6570nqbits\:5fc5\:987b\:662f\:6b63\:6574\:6570\:ff01\>\"\
"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ApplyGate", "::", "errmsg4"}], "=", 
        "\"\<\:53c2\:6570indexlist\:7684\:957f\:5ea6\:4e0egate\:7684\:7ef4\
\:5ea6\:4e0d\:5339\:914d\:ff01\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ApplyGate", "::", "errmsg5"}], "=", 
        "\"\<\:53c2\:6570nqbits\:4e0d\:80fd\:5c0f\:4e8eindexlist\:7684\:957f\
\:5ea6\:ff01\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{"cond", "=", 
        RowBox[{"Catch", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MatrixQ", "[", "gate", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg1"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ListQ", "[", "indexlist", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg2"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DuplicateFreeQ", "[", "indexlist", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg2"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"IntegerQ", "[", "nqbits", "]"}], " ", "And", " ", 
              "nqbits"}], ">", "0"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg3"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "gate", "]"}], ",", "1"}], "]"}], "==", 
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "gate", "]"}], ",", "2"}], "]"}]}], 
            ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg1"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"gdim", "=", 
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"Dimensions", "[", "gate", "]"}], ",", "1"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"ngatebits", "=", 
           RowBox[{"Log2", "[", "gdim", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"IntegerQ", "[", "ngatebits", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg1"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ngatebits", "==", 
             RowBox[{"Length", "[", "indexlist", "]"}]}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg4"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"nqbits", ">=", "ngatebits"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg5"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"AllTrue", "[", 
             RowBox[{"indexlist", ",", 
              RowBox[{"Between", "[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "nqbits"}], "}"}], "]"}]}], "]"}], ",", " ",
             ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ApplyGate", "::", "errmsg2"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", "True", "]"}], ";"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"cond", ",", 
         RowBox[{
          RowBox[{"cindexlist", "=", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"Range", "[", "nqbits", "]"}], ",", "indexlist"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"addlist", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "<=", 
             RowBox[{"2", "^", 
              RowBox[{"Length", "[", "cindexlist", "]"}]}]}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{
             RowBox[{"digi1", "=", 
              RowBox[{"IntegerDigits", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "2", ",", 
                RowBox[{"Length", "[", "cindexlist", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"tmpval1", "=", "0"}], ";", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "<=", 
                RowBox[{"Length", "[", "cindexlist", "]"}]}], ",", 
               RowBox[{"j", "++"}], ",", 
               RowBox[{"tmpval1", "+=", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{
                  RowBox[{"Part", "[", 
                   RowBox[{"digi1", ",", "j"}], "]"}], ",", 
                  RowBox[{"nqbits", "-", 
                   RowBox[{"Part", "[", 
                    RowBox[{"cindexlist", ",", "j"}], "]"}]}]}], "]"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"addlist", ",", "tmpval1"}], "]"}], ";"}]}], "]"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "<=", "gdim"}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "<=", "gdim"}], ",", 
               RowBox[{"j", "++"}], ",", 
               RowBox[{
                RowBox[{"digi1", "=", 
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{"i", "-", "1"}], ",", "2", ",", "ngatebits"}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"digi2", "=", 
                 RowBox[{"IntegerDigits", "[", 
                  RowBox[{
                   RowBox[{"j", "-", "1"}], ",", "2", ",", "ngatebits"}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"tmpval1", "=", 
                 RowBox[{"tmpval2", "=", "0"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"For", "[", 
                 RowBox[{
                  RowBox[{"k", "=", "1"}], ",", 
                  RowBox[{"k", "<=", "ngatebits"}], ",", 
                  RowBox[{"k", "++"}], ",", 
                  RowBox[{
                   RowBox[{"tmpval1", "+=", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"digi1", ",", "k"}], "]"}], ",", 
                    RowBox[{"nqbits", "-", 
                    RowBox[{"Part", "[", 
                    RowBox[{"indexlist", ",", "k"}], "]"}]}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"tmpval2", "+=", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"digi2", ",", "k"}], "]"}], ",", 
                    RowBox[{"nqbits", "-", 
                    RowBox[{"Part", "[", 
                    RowBox[{"indexlist", ",", "k"}], "]"}]}]}], "]"}]}], 
                   ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"For", "[", 
                 RowBox[{
                  RowBox[{"k", "=", "1"}], ",", 
                  RowBox[{"k", "<=", 
                   RowBox[{"Length", "[", "addlist", "]"}]}], ",", 
                  RowBox[{"k", "++"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"ret", ",", 
                    RowBox[{
                    RowBox[{"BitOr", "[", 
                    RowBox[{"tmpval1", ",", 
                    RowBox[{"Part", "[", 
                    RowBox[{"addlist", ",", "k"}], "]"}]}], "]"}], "+", "1"}],
                     ",", 
                    RowBox[{
                    RowBox[{"BitOr", "[", 
                    RowBox[{"tmpval2", ",", 
                    RowBox[{"Part", "[", 
                    RowBox[{"addlist", ",", "k"}], "]"}]}], "]"}], "+", 
                    "1"}]}], "]"}], "=", 
                    RowBox[{"Part", "[", 
                    RowBox[{"gate", ",", "i", ",", "j"}], "]"}]}], ";"}]}], 
                 "]"}], ";"}]}], "]"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Normal", "[", "ret", "]"}]}], ",", "$Failed"}], "]"}]}]}], 
     "]"}]}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:751f\:6210\:5177\:6709nctrlbits\:4e2a\:63a7\:5236\:6bd4\:7279\:7684\
\:53d7\:63a7\:7248\:672c\:7684gate\:95e8\:7684\:77e9\:9635\:8868\:793a", 
     "\:3002", 
     "\:751f\:6210\:7684\:53d7\:63a7\:95e8\:4e2d\:524dnctrlbits\:4e2a\:91cf\
\:5b50\:6bd4\:7279\:4e3a\:63a7\:5236\:4f4d", "\:ff0c", 
     "\:540e\:7eed\:7684\:91cf\:5b50\:6bd4\:7279\:4f5c\:7528gate\:95e8", 
     "\:3002"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ControlledGate", "[", 
     RowBox[{"gate_", ",", "nctrlbits_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ids", ",", 
        RowBox[{"cond", "=", "True"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ControlledGate", "::", "errmsg1"}], "=", 
        "\"\<\:53c2\:6570gate\:5fc5\:987b\:662f\:65b9\:9635\:ff01\>\""}], ";",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ControlledGate", "::", "errmsg2"}], "=", 
        "\"\<\:53c2\:6570nctrlbits\:5fc5\:987b\:662f\:6b63\:6574\:6570\:ff01\>\
\""}], ";", "\[IndentingNewLine]", 
       RowBox[{"cond", "=", 
        RowBox[{"Catch", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MatrixQ", "[", "gate", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ControlledGate", "::", "errmsg1"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "gate", "]"}], ",", "1"}], "]"}], "==", 
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "gate", "]"}], ",", "2"}], "]"}]}], 
            ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ControlledGate", "::", "errmsg1"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"IntegerQ", "[", "nctrlbits", "]"}], " ", "And", " ", 
              "nctrlbits"}], ">", "0"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ControlledGate", "::", "errmsg2"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", "True", "]"}], ";"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"cond", ",", 
         RowBox[{
          RowBox[{"ids", "=", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "gate", "]"}], ",", "1"}], "]"}], 
             "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"2", "^", "nctrlbits"}], "-", "1"}], ")"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Normal", "[", 
           RowBox[{"BlockDiagonalMatrix", "[", 
            RowBox[{"{", 
             RowBox[{"ids", ",", "gate"}], "}"}], "]"}], "]"}]}], ",", 
         "$Failed"}], "]"}]}]}], "]"}]}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:5bf9\:603b\:5171nqbits\:4e2a\:91cf\:5b50\:6bd4\:7279\:7684\:6bcf\:4e00\
\:4e2a\:5206\:522b\:5e94\:7528\:5355\:6bd4\:7279\:91cf\:5b50\:95e8sqgate", 
     "\:ff0c", "\:751f\:6210\:5bf9\:5e94\:7684\:77e9\:9635\:8868\:793a", 
     "\:3002"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MultiGate", "[", 
     RowBox[{"sqgate_", ",", "nqbits_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"cond", "=", "True"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{"{", 
          RowBox[{"{", "1", "}"}], "}"}]}], ",", "i"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"MultiGate", "::", "errmsg1"}], "=", 
        "\"\<\:53c2\:6570sqgate\:5fc5\:987b\:662f2\[Times]2\:77e9\:9635\:ff01\
\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MultiGate", "::", "errmsg2"}], "=", 
        "\"\<\:53c2\:6570nqbits\:5fc5\:987b\:662f\:6b63\:6574\:6570\:ff01\>\"\
"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cond", "=", 
        RowBox[{"Catch", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MatrixQ", "[", "sqgate", "]"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"MultiGate", "::", "errmsg1"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Dimensions", "[", "sqgate", "]"}], ",", "1"}], "]"}], 
             "==", 
             RowBox[{"2", " ", "And", " ", 
              RowBox[{"Part", "[", 
               RowBox[{
                RowBox[{"Dimensions", "[", "sqgate", "]"}], ",", "2"}], 
               "]"}]}], "==", "2"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"MultiGate", "::", "errmsg1"}], "]"}], ";", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"IntegerQ", "[", "nqbits", "]"}], " ", "And", " ", 
              "nqbits"}], ">", "0"}], ",", " ", ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"MultiGate", "::", "errmsg2"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Throw", "[", "False", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", "True", "]"}], ";"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"cond", ",", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "0"}], ",", 
            RowBox[{"i", "<", "nqbits"}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{"ret", "=", 
             RowBox[{"KroneckerProduct", "[", 
              RowBox[{"ret", ",", "sqgate"}], "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", "ret"}], ",", "$Failed"}], "]"}]}]}], 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\:884d\:751f\:7684\:53d7\:63a7\:95e8", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Toffoli", ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{"X", ",", "2"}], "]"}]}], "\n", 
   RowBox[{"Fredkin", ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{"SWAP", ",", "1"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"CCZ", ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{"Z", ",", "2"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"CY", ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{"Y", ",", "1"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"CH", ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{"H", ",", "1"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CRx", "[", "theta_", "]"}], ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{
      RowBox[{"Rx", "[", "theta", "]"}], ",", "1"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CRy", "[", "theta_", "]"}], ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{
      RowBox[{"Ry", "[", "theta", "]"}], ",", "1"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CRz", "[", "theta_", "]"}], ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{
      RowBox[{"Rz", "[", "theta", "]"}], ",", "1"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CU1", "[", "theta_", "]"}], ":=", 
    RowBox[{"ControlledGate", "[", 
     RowBox[{
      RowBox[{"U1", "[", "theta", "]"}], ",", "1"}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:7cbe\:786e\:7684\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\:6a21\:62df", 
     "\:ff0c", "\:4ee5hamiltonian\:4e3a\:54c8\:5bc6\:987f\:91cf\:77e9\:9635", 
     "\:ff0c", "\:6f14\:5316\:65f6\:95f4t"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"HamiltonianSimulation", "[", 
     RowBox[{"hamiltonian_", ",", "t_"}], "]"}], ":=", 
    RowBox[{"MatrixFunction", "[", 
     RowBox[{"Exp", ",", 
      RowBox[{
       RowBox[{"-", "I"}], "*", "hamiltonian", "*", "t"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:7cbe\:786e\:7684\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\:6a21\:62df", 
     "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"SubHamiltonianSumSimulation", "[", 
     RowBox[{"shlist_", ",", "t_"}], "]"}], ":=", 
    RowBox[{"HamiltonianSimulation", "[", 
     RowBox[{
      RowBox[{"Total", "[", "shlist", "]"}], ",", "t"}], "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "\:6309\:7167Trotter\:5206\:89e3\:7684\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\
\:6a21\:62df\:8fd1\:4f3c", "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t", "\:ff0c", 
     "\:5206\:89e3\:6b21\:6570ndiv"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ApproximateHamiltonianSimulationTrotter", "[", 
     RowBox[{"shlist_", ",", "t_", ",", "ndiv_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"explist", ",", "roundmatrix", ",", "ret"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"hsimdt", "[", "x_", "]"}], ":=", 
        RowBox[{"HamiltonianSimulation", "[", 
         RowBox[{"x", ",", 
          RowBox[{"t", "/", "ndiv"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"explist", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"hsimdt", ",", "shlist"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"roundmatrix", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"Dot", ",", "explist"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ret", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"roundmatrix", ",", "ndiv"}], "]"}]}]}]}], "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "\:6309\:7167\:4e8c\:9636Suzuki\:5206\:89e3\:7684\:91cf\:5b50\:54c8\:5bc6\
\:987f\:91cf\:6a21\:62df\:8fd1\:4f3c", "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t", "\:ff0c", 
     "\:5206\:89e3\:6b21\:6570ndiv"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ApproximateHamiltonianSimulationSuzuki2", "[", 
     RowBox[{"shlist_", ",", "t_", ",", "ndiv_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"explist", ",", "roundmatrix", ",", "ret"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"hsimdt2", "[", "x_", "]"}], ":=", 
        RowBox[{"HamiltonianSimulation", "[", 
         RowBox[{"x", ",", 
          RowBox[{
           RowBox[{"t", "/", "ndiv"}], "/", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"explist", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"hsimdt2", ",", "shlist"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"roundmatrix", "=", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Dot", ",", "explist"}], "]"}], ".", 
         RowBox[{"Apply", "[", 
          RowBox[{"Dot", ",", 
           RowBox[{"Reverse", "[", "explist", "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ret", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"roundmatrix", ",", "ndiv"}], "]"}]}]}]}], "]"}]}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:6570\:503c\:8ba1\:7b97\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\:6a21\:62df\
", "\:ff0c", "\:4ee5hamiltonian\:4e3a\:54c8\:5bc6\:987f\:91cf\:77e9\:9635", 
     "\:ff0c", "\:6f14\:5316\:65f6\:95f4t"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NHamiltonianSimulation", "[", 
     RowBox[{"hamiltonian_", ",", "t_"}], "]"}], ":=", 
    RowBox[{"MatrixFunction", "[", 
     RowBox[{"Exp", ",", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"-", "I"}], "*", "hamiltonian", "*", "t"}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:6570\:503c\:8ba1\:7b97\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\:6a21\:62df\
", "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"NSubHamiltonianSumSimulation", "[", 
     RowBox[{"shlist_", ",", "t_"}], "]"}], ":=", 
    RowBox[{"NHamiltonianSimulation", "[", 
     RowBox[{
      RowBox[{"Total", "[", "shlist", "]"}], ",", "t"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:6570\:503c\:8ba1\:7b97\:6309\:7167Trotter\:5206\:89e3\:7684\:91cf\:5b50\
\:54c8\:5bc6\:987f\:91cf\:6a21\:62df\:8fd1\:4f3c", "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t", "\:ff0c", 
     "\:5206\:89e3\:6b21\:6570ndiv"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"NApproximateHamiltonianSimulationTrotter", "[", 
     RowBox[{"shlist_", ",", "t_", ",", "ndiv_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"explist", ",", "roundmatrix", ",", "ret"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"hsimdt", "[", "x_", "]"}], ":=", 
        RowBox[{"NHamiltonianSimulation", "[", 
         RowBox[{"x", ",", 
          RowBox[{"t", "/", "ndiv"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"explist", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"hsimdt", ",", "shlist"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"roundmatrix", "=", 
        RowBox[{"Apply", "[", 
         RowBox[{"Dot", ",", "explist"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ret", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"roundmatrix", ",", "ndiv"}], "]"}]}]}]}], "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "\:6570\:503c\:8ba1\:7b97\:6309\:7167\:4e8c\:9636Suzuki\:5206\:89e3\:7684\
\:91cf\:5b50\:54c8\:5bc6\:987f\:91cf\:6a21\:62df\:8fd1\:4f3c", "\:ff0c", 
     "\:4ee5shlist\:4e2d\:7684\:77e9\:9635\:6c42\:548c\:4e3a\:54c8\:5bc6\:987f\
\:91cf", "\:ff0c", "\:6f14\:5316\:65f6\:95f4t", "\:ff0c", 
     "\:5206\:89e3\:6b21\:6570ndiv"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NApproximateHamiltonianSimulationSuzuki2", "[", 
     RowBox[{"shlist_", ",", "t_", ",", "ndiv_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"explist", ",", "roundmatrix", ",", "ret"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"hsimdt2", "[", "x_", "]"}], ":=", 
        RowBox[{"NHamiltonianSimulation", "[", 
         RowBox[{"x", ",", 
          RowBox[{
           RowBox[{"t", "/", "ndiv"}], "/", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"explist", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"hsimdt2", ",", "shlist"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"roundmatrix", "=", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Dot", ",", "explist"}], "]"}], ".", 
         RowBox[{"Apply", "[", 
          RowBox[{"Dot", ",", 
           RowBox[{"Reverse", "[", "explist", "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ret", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"roundmatrix", ",", "ndiv"}], "]"}]}]}]}], "]"}]}], 
   "\n"}]}]], "Input",
 CellChangeTimes->{{3.9641361274641*^9, 3.9641361295872493`*^9}, {
   3.9739085106334105`*^9, 3.973908579003745*^9}, {3.9739088083078747`*^9, 
   3.9739088380514016`*^9}, {3.974331338491068*^9, 3.9743313796013412`*^9}, 
   3.974351278983327*^9, {3.974351918525691*^9, 3.974352078447812*^9}, {
   3.9743526015447483`*^9, 3.9743527514342117`*^9}, {3.9743527974799385`*^9, 
   3.9743528148231897`*^9}, 3.9743528488892546`*^9, {3.974353170264509*^9, 
   3.9743531718783345`*^9}, {3.974776664299662*^9, 3.9747767365785484`*^9}, {
   3.974782577853001*^9, 3.974782597326609*^9}, {3.974782640832895*^9, 
   3.974782659921464*^9}, {3.974783586765644*^9, 3.9747835937540646`*^9}, {
   3.974785425605584*^9, 3.97478563056857*^9}, {3.974785691962513*^9, 
   3.974785693019088*^9}, {3.9747859750103397`*^9, 3.9747859864710126`*^9}, {
   3.9748543422188067`*^9, 3.974854342952689*^9}, 3.9748544443239403`*^9, {
   3.974854491190399*^9, 3.974854511677419*^9}, {3.9759776038252974`*^9, 
   3.975977649061276*^9}, {3.975977692183366*^9, 3.9759779445116405`*^9}, {
   3.976158083188986*^9, 
   3.976158092506972*^9}},ExpressionUUID->"bec45640-fbd1-4bb5-ba5a-\
c972f369b820"]
},
WindowSize->{1430.25, 732.75},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"13.1 for Microsoft Windows (64-bit) (2022\:5e746\:670816\
\:65e5)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"29811a35-f9c5-472d-b14a-c0cb3d118842"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 47978, 1246, 4963, "Input",ExpressionUUID->"bec45640-fbd1-4bb5-ba5a-c972f369b820"]
}
]
*)

